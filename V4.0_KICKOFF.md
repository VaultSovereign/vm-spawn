# v4.0 — Federated C3L (Kickoff)

**Status:** ✅ Weeks 1-2 Complete (Foundation)  
**Date:** 2025-10-19

## Vision

Transform VaultMesh from cryptographic single-node to federated civilization where multiple Remembrancer nodes sync memories, AI agents coordinate via MCP, and workflows are event-driven.

## Phase 1: Foundation (Weeks 1-2) ✅ COMPLETE

### Remembrancer MCP Server
- [x] Wrap CLI as MCP server (`ops/mcp/remembrancer_server.py`)
- [x] Expose resources: `memory://`, `adr://`, `receipt://`, `merkle://root`
- [x] Expose tools: `search_memories`, `verify_artifact`, `sign_artifact`, `record_decision`
- [x] Expose prompts: `adr_template`, `deployment_postmortem`
- [x] Stdio transport (for local development)
- [x] HTTP transport option (via `REMEMBRANCER_MCP_HTTP=1`)

### Federation Protocol MVP
- [x] Define `MemoryProjection` model
- [x] Create `ops/lib/federation.py` with core classes
- [x] Add `remembrancer federation` CLI commands (init, join, status)
- [x] Create `ops/data/federation.yaml.example`
- [ ] Implement Merkle diff algorithm (Phase 2, weeks 3-4)
- [ ] Implement full sync protocol (Phase 2, weeks 3-4)

### Testing
- [x] Smoke test 24: MCP server boot check

## Running the MCP Server

### Stdio Mode (Local Development)
```bash
cd ops/mcp
uv run mcp dev remembrancer_server.py
# Opens MCP Inspector for interactive testing
```

### HTTP Mode (Federation)
```bash
cd ops/mcp
REMEMBRANCER_MCP_HTTP=1 uv run python remembrancer_server.py --http --port 8001
# Server listens on http://localhost:8001/mcp
```

### Testing with curl
```bash
curl http://localhost:8001/mcp \
  -H "Content-Type: application/json" \
  -d '{"method":"tools/list","params":{}}'
```

## Federation Commands

### Initialize Federation
```bash
./ops/bin/remembrancer federation init
# Creates ops/data/federation.yaml with example config
```

### Join Federation (Add Peer)
```bash
./ops/bin/remembrancer federation join \
  --peer http://peer.example.com:8001/mcp \
  --trust-anchor ops/certs/peer-pubkey.asc
# Appends peer to federation.yaml
```

### Check Status
```bash
./ops/bin/remembrancer federation status
# Shows current federation config
```

## Next Steps (Phase 2: Weeks 3-4)

- [ ] Implement MerkleDiff.compute_diff() (tree diffing algorithm)
- [ ] Implement MemoryValidator.verify_memory() (GPG + timestamp verification)
- [ ] Implement sync protocol (pull missing memories from peers)
- [ ] Add conflict resolution (Last-Write-Wins with vector clocks)
- [ ] Integration test: 3-node federation

## Architecture

```
┌─────────────────────────────────────────────────────────┐
│  Remembrancer (Local Node)                              │
│  ├── CLI (ops/bin/remembrancer)                         │
│  ├── MCP Server (ops/mcp/remembrancer_server.py)        │
│  ├── Federation (ops/lib/federation.py)                 │
│  └── Database (ops/data/remembrancer.db)                │
└─────────────────────────────────────────────────────────┘
                       ↕ MCP Protocol
┌─────────────────────────────────────────────────────────┐
│  Peer Remembrancer Nodes                                │
│  └── Sync memories, verify signatures, merge trees      │
└─────────────────────────────────────────────────────────┘
```

## Dependencies

- Python 3.11+ ✅
- FastMCP SDK ≥1.2.0 (install: `pip install mcp`)
- PyYAML (install: `pip install pyyaml`)
- uv ✅ (for MCP development)

## Covenant Alignment

- **Self-Verifying:** MCP resources expose provable data ✅
- **Self-Auditing:** Federation events logged (future) ⏳
- **Self-Attesting:** MCP tools provide cryptographic verification ✅

---

🜂 **Solve et Coagula.** The federation breathes.

